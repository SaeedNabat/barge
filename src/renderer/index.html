<!doctype html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta http-equiv="Content-Security-Policy" content="default-src 'self' http://localhost:5173 http://127.0.0.1:5173; script-src 'self' http://localhost:5173 http://127.0.0.1:5173 'unsafe-eval'; style-src 'self' http://localhost:5173 http://127.0.0.1:5173 'unsafe-inline'; worker-src 'self' blob: http://localhost:5173 http://127.0.0.1:5173; connect-src 'self' data: blob: http://localhost:5173 http://127.0.0.1:5173 ws://localhost:5173 ws://127.0.0.1:5173; img-src 'self' data: blob:; font-src 'self' data:;" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>Barge Editor</title>
		<link rel="stylesheet" href="styles.css" />
		<script src="/monaco-editor/min/vs/loader.js"></script>
	</head>
	<body>
		<div class="window gradient-bg">
			<div class="titlebar" style="-webkit-app-region: drag;">
				<div class="title">
					<img src="../assets/barge.png" alt="Barge" class="app-logo" />
					<span>Barge</span>
				</div>
				<div class="window-controls" style="-webkit-app-region: no-drag;">
					<button id="winMin" title="Minimize" aria-label="Minimize">
						<svg width="16" height="16" viewBox="0 0 24 24" fill="#38bdf8"><rect x="6" y="11" width="12" height="2" rx="1"/></svg>
					</button>
					<button id="winMax" title="Maximize" aria-label="Maximize">
						<svg width="16" height="16" viewBox="0 0 24 24" fill="#22c55e"><rect x="3" y="3" width="18" height="18" rx="2"/></svg>
					</button>
					<button id="winClose" title="Close" aria-label="Close">
						<svg width="16" height="16" viewBox="0 0 24 24" fill="#ef4444">
							<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z"/>
						</svg>
					</button>
				</div>
			</div>
			<nav class="menubar" id="menubar" style="-webkit-app-region: no-drag;">
				<div class="menu" data-menu="file">
					<span class="menu-label">File</span>
					<div class="dropdown">
						<button class="menu-item" id="mFileNew"><span>New File</span><kbd>Ctrl+N</kbd></button>
						<button class="menu-item" id="mFileNewWindow"><span>New Window</span><kbd>Ctrl+Shift+N</kbd></button>
						<button class="menu-item" id="mFileOpen"><span>Open…</span><kbd>Ctrl+O</kbd></button>
						<button class="menu-item" id="mFileQuickOpen"><span>Quick Open…</span><kbd>Ctrl+P</kbd></button>
						<button class="menu-item" id="mFileOpenFolder"><span>Open Folder…</span><kbd>Ctrl+K Ctrl+O</kbd></button>
						<button class="menu-item" id="mFileCloseFolder"><span>Close Folder</span></button>
						<button class="menu-item" id="mFileSave"><span>Save</span><kbd>Ctrl+S</kbd></button>
						<button class="menu-item" id="mFileSaveAll"><span>Save All</span></button>
						<button class="menu-item" id="mFileSaveAs"><span>Save As…</span><kbd>Ctrl+Shift+S</kbd></button>
						<div class="menu-sep"></div>
						<button class="menu-item" id="mFileOpenRecentFile"><span>Open Recent File…</span></button>
						<button class="menu-item" id="mFileOpenRecentFolder"><span>Open Recent Folder…</span></button>
						<div class="menu-sep"></div>
						<button class="menu-item" id="mFileCloseAll"><span>Close All</span></button>
						<button class="menu-item" id="mFileReopenClosed"><span>Reopen Closed Tab</span></button>
						<button class="menu-item" id="mFileExit"><span>Exit</span></button>
					</div>
				</div>
				<div class="menu" data-menu="edit">
					<span class="menu-label">Edit</span>
					<div class="dropdown">
						<button class="menu-item" id="mEditUndo"><span>Undo</span><kbd>Ctrl+Z</kbd></button>
						<button class="menu-item" id="mEditRedo"><span>Redo</span><kbd>Ctrl+Y</kbd></button>
						<div class="menu-sep"></div>
						<button class="menu-item" id="mEditFind"><span>Find</span><kbd>Ctrl+F</kbd></button>
						<button class="menu-item" id="mEditGoToLine"><span>Go to Line…</span><kbd>Ctrl+G</kbd></button>
						<button class="menu-item" id="mEditPreferences"><span>Preferences…</span><kbd>Ctrl+,</kbd></button>
					</div>
				</div>
				<div class="menu" data-menu="view">
					<span class="menu-label">View</span>
					<div class="dropdown">
						<button class="menu-item" id="mViewToggleSidebar"><span>Toggle Sidebar</span><kbd>Ctrl+B</kbd></button>
						<button class="menu-item" id="mViewSplit"><span>Split Editor</span></button>
						<button class="menu-item" id="mViewUnsplit"><span>Unsplit Editor</span></button>
						<div class="menu-sep"></div>
						<button class="menu-item" id="mViewToggleStatus"><span>Toggle Status Bar</span></button>
						<button class="menu-item" id="mViewToggleWordWrap"><span>Toggle Word Wrap</span><kbd>Alt+Z</kbd></button>
						<button class="menu-item" id="mViewToggleLineNumbers"><span>Toggle Line Numbers</span></button>
						<button class="menu-item" id="mViewToggleWhitespace"><span>Toggle Render Whitespace</span></button>
						<button class="menu-item" id="mViewToggleTerminal"><span>Toggle Terminal</span><kbd>Ctrl+`</kbd></button>
						<button class="menu-item" id="mViewFullScreen"><span>Toggle Full Screen</span><kbd>F11</kbd></button>
						<button class="menu-item" id="mViewZenMode"><span>Toggle Zen Mode</span><kbd>Ctrl+K, Z</kbd></button>
					</div>
				</div>
				<div class="menu" data-menu="help">
					<span class="menu-label">Help</span>
					<div class="dropdown">
						<button class="menu-item" id="mHelpAbout"><span>About</span></button>
					</div>
				</div>
			</nav>
			<div class="app">
				<aside class="sidebar">
					<div class="sidebar-toolbar">
						<button id="sidebarNewFile" title="New File" class="icon-btn accent" aria-label="New File">
							<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#60a5fa" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
								<path d="M14 2H8a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V8z"/>
								<path d="M14 2v6h6"/>
								<path d="M12 11v6"/>
								<path d="M9 14h6"/>
							</svg>
						</button>
						<button id="sidebarNewFolder" title="New Folder" class="icon-btn" aria-label="New Folder">
							<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#34d399" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
								<path d="M3 7h5l2 2h9a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V7z"/>
								<path d="M12 13v6"/>
								<path d="M9 16h6"/>
							</svg>
						</button>
					</div>
					<div id="sidebarWelcome" class="sidebar-welcome" style="display:none">
						<div class="sidebar-welcome-buttons">
							<button id="sidebarOpenFile" class="sidebar-welcome-btn">
								<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<path d="M14 2H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V9z"/>
									<path d="M14 2v7h7"/>
								</svg>
								Open File
							</button>
							<button id="sidebarOpenFolder" class="sidebar-welcome-btn">
								<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<path d="M3 7h5l2 2h9a2 2 0 0 1 2 2v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
								</svg>
								Open Folder
							</button>
						</div>
					</div>
					<div class="file-tree-filter">
						<input id="fileTreeFilter" type="text" placeholder="Filter files (filename contains…)" />
						<button id="collapseAllBtn" class="icon-btn" title="Collapse All" aria-label="Collapse All Folders">
							<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
								<polyline points="6 9 12 15 18 9"></polyline>
							</svg>
						</button>
					</div>
					<div id="fileTree" class="file-tree"></div>
				</aside>
				<main class="main">
					<header class="topbar">
						<div class="tabs" id="tabs"></div>
						<div class="breadcrumb" id="breadcrumb"></div>
						<div class="actions">
							<button id="toggleMinimap" class="icon-btn" title="Toggle Minimap" aria-label="Toggle Minimap">
								<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<rect x="3" y="3" width="18" height="18" rx="2"/>
									<path d="M9 3v18"/>
								</svg>
							</button>
							<span id="filename"></span>
						</div>
					</header>
					<div id="editorSplit" class="editor-split">
						<div id="editor"></div>
						<div id="editor2" class="hidden"></div>
						<div id="editorEmpty" class="editor-empty hidden"><div><div class="title">Welcome to Barge Editor</div><div class="subtitle">Open a file or folder to get started</div></div></div>
					</div>
					<div id="problemsPanel" class="problems hidden" aria-label="Problems Panel" role="region">
						<div class="problems-header">
							<div class="title">Problems</div>
							<div class="actions">
								<button id="problemsToggle" title="Toggle Problems (Ctrl+Shift+M)">≡</button>
							</div>
						</div>
						<div id="problemsList" class="problems-list" role="list"></div>
					</div>
					<div id="terminalPanel" class="terminal hidden">
						<div class="terminal-header">
							<div id="terminalTabs" class="terminal-tabs"></div>
							<button id="terminalNew" class="terminal-new" title="New Terminal">+</button>
							<button id="terminalClosePanel" class="terminal-close" title="Close Terminal Panel">×</button>
						</div>
						<div id="terminalViews" class="terminal-views"></div>
					</div>
					<footer class="statusbar">
						<span id="gitBranch" class="git-branch" title="Git branch"></span>
						<span id="cursorPos">Ln 1, Col 1</span>
						<span id="selection" class="selection-info" title="Selection"></span>
						<span id="lang">plaintext</span>
						<span id="encoding" class="encoding" title="File encoding">UTF-8</span>
						<span id="eol" class="eol" title="Line ending">LF</span>
						<span id="tabSize" class="tab-size" title="Click to change tab size">Spaces: 4</span>
						<span id="problemsCount" class="problems-count" aria-live="polite"></span>
					</footer>
				</main>
			</div>
		</div>
		<!-- modals below -->
		<!-- Quick Open -->
		<div id="quickOpen" class="modal hidden">
			<div class="modal-backdrop"></div>
			<div class="modal-card qo-card">
				<div class="cmd-input-wrap">
					<span class="input-icon" aria-hidden="true">
						<svg width="16" height="16" viewBox="0 0 24 24" fill="none"><circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="2"/><path d="M20 20l-3.5-3.5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
					</span>
					<input id="qoInput" type="text" placeholder="Type to search files…" autocomplete="off" />
				</div>
				<div id="qoList" class="cmd-list"></div>
				<div id="qoEmpty" class="cmd-empty hidden">No matches. Start typing to search.</div>
			</div>
		</div>
		<div id="prefsModal" class="modal hidden">
			<div class="modal-backdrop"></div>
			<div class="modal-card">
				<div class="modal-header">
					<h3>Preferences</h3>
				</div>
				<div class="modal-body">
					<label class="field">
						<span>Theme</span>
						<select id="prefTheme">
							<option value="dark">Dark</option>
							<option value="light">Light</option>
							<option value="dracula">Dracula</option>
							<option value="nord">Nord</option>
							<option value="monokai">Monokai</option>
						</select>
					</label>
					<label class="field">
						<span>Editor font family</span>
						<input id="prefFontFamily" type="text" placeholder="e.g. JetBrains Mono, Fira Code, monospace" />
					</label>
					<label class="field">
						<span>Editor font size</span>
						<input id="prefFontSize" type="number" min="8" max="48" step="1" />
					</label>
					<div class="field">
						<span>Tab Size <small id="prefTabSizeVal" style="opacity:.8;margin-left:6px;">4 spaces</small></span>
						<input id="prefTabSize" type="range" min="1" max="16" step="1" />
					</div>
					<label class="field">
						<span>Auto save</span>
						<select id="prefAutoSave">
							<option value="off">Off</option>
							<option value="afterDelay">After Delay</option>
							<option value="onFocusChange">On Focus Change</option>
						</select>
					</label>
					<label class="field" id="autoSaveDelayField">
						<span>Auto save delay (ms)</span>
						<input id="prefAutoSaveDelay" type="number" min="100" max="10000" step="100" />
					</label>
					<label class="field">
						<span>Format on save</span>
						<input id="prefFormatOnSave" type="checkbox" />
					</label>
					<label class="field">
						<span>Font ligatures</span>
						<input id="prefFontLigatures" type="checkbox" />
					</label>
					<label class="field">
						<span>Compact mode</span>
						<input id="prefCompactMode" type="checkbox" />
					</label>
					<div class="field">
						<span>Cursor Blink Rate <small id="prefCursorBlinkVal" style="opacity:.8;margin-left:6px;">1200 ms</small></span>
						<input id="prefCursorBlink" type="range" min="300" max="3000" step="100" />
					</div>
				</div>
				<div class="modal-footer">
					<button id="prefsCancel" class="btn btn-ghost">Cancel</button>
					<button id="prefsSave" class="btn btn-primary">Save</button>
				</div>
			</div>
		</div>
		<div id="emptyStateModal" class="modal hidden">
			<div class="modal-backdrop"></div>
			<div class="modal-card">
				<div class="modal-header"><h3>Welcome to Barge</h3></div>
				<div class="modal-body">
					<p style="margin:0 0 8px; color:#9aa4b2;">Open a file or a folder to get started.</p>
					<div style="display:flex; gap:8px;">
						<button id="emptyOpenFile" class="btn btn-primary">Open File</button>
						<button id="emptyOpenFolder" class="btn">Open Folder</button>
					</div>
				</div>
				<div class="modal-footer">
					<button id="emptyClose" class="btn btn-ghost">Close</button>
				</div>
			</div>
		</div>
		<!-- Input Modal -->
		<div id="inputModal" class="modal hidden">
			<div class="modal-backdrop"></div>
			<div class="modal-card">
				<div class="modal-header"><h3 id="inputTitle">Enter Name</h3></div>
				<div class="modal-body">
					<label class="field">
						<span id="inputLabel">Name</span>
						<input id="inputField" type="text" autocomplete="off" />
					</label>
					<div id="inputError" style="color:#fca5a5; font-size:12px; display:none;"></div>
				</div>
				<div class="modal-footer">
					<button id="inputCancel" class="btn btn-ghost">Cancel</button>
					<button id="inputOk" class="btn btn-primary">Create</button>
				</div>
			</div>
		</div>
		<!-- Command Palette -->
		<div id="cmdPalette" class="modal hidden">
			<div id="cmdBackdrop" class="modal-backdrop"></div>
			<div id="cmdCard" class="modal-card cmd-card">
				<div class="cmd-input-wrap input-group">
					<span class="input-icon" aria-hidden="true">
						<svg width="16" height="16" viewBox="0 0 24 24" fill="none"><circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="2"/><path d="M20 20l-3.5-3.5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
					</span>
					<input id="cmdInput" type="text" placeholder="Run a command… (e.g. Open File, Toggle Theme)" autocomplete="off" />
				</div>
				<div id="cmdList" class="cmd-list"></div>
				<div id="cmdEmpty" class="cmd-empty hidden">No matches. Try different keywords.</div>
			</div>
		</div>
		
		<!-- About Modal -->
		<div id="aboutModal" class="modal hidden">
			<div class="modal-backdrop"></div>
			<div class="modal-card about-card">
				<div class="about-header">
					<img src="../assets/barge.png" alt="Barge" class="about-logo" />
					<h2>Barge Editor</h2>
					<p class="version">Version 1.0.0</p>
				</div>
				<div class="about-content">
					<p>A modern, feature-rich code editor built with Electron and Monaco Editor.</p>
					<div class="about-features">
						<h3>Features</h3>
						<ul>
							<li>Syntax highlighting for multiple languages</li>
							<li>Integrated terminal</li>
							<li>File tree navigation</li>
							<li>Dark/Light theme support</li>
							<li>Command palette</li>
							<li>Search and replace</li>
						</ul>
					</div>
					<div class="about-footer">
						<p>&copy; 2024 Barge Editor. Built with ❤️ using Electron.</p>
					</div>
				</div>
				<button id="aboutClose" class="modal-close">×</button>
			</div>
		</div>
		
		<!-- Load xterm browser bundle so Terminal is global -->
		<div id="recentModal" class="modal hidden">
			<div class="modal-backdrop"></div>
			<div class="modal-card recent-card">
				<div class="modal-header"><h3 id="recentTitle">Open Recent</h3></div>
				<div class="modal-body">
					<div class="recent-kind-switch">
						<button id="recentSwitchFile" class="btn btn-small btn-primary">Files</button>
						<button id="recentSwitchFolder" class="btn btn-small">Folders</button>
					</div>
					<div id="recentList" class="recent-list"></div>
				</div>
				<div class="modal-footer">
					<button id="recentCancel" class="btn btn-ghost">Close</button>
				</div>
			</div>
		</div>
		<script src="renderer.js"></script>
	</body>
		<!-- Floating Action Button -->
		<button id="fabGoTop" class="fab" title="Go to first line" aria-label="Go to first line">
			<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
				<path d="M18 15l-6-6-6 6"/>
			</svg>
		</button>
</html>
